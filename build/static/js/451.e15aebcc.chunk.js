"use strict";(self.webpackChunkfacit=self.webpackChunkfacit||[]).push([[451],{10451:(e,s,i)=>{i.r(s),i.d(s,{default:()=>L});var a=i(65043),r=i(70949),l=i(30242),t=i(32922),d=i(26930),n=i(97043),c=i(47819),o=i(64761),h=i(26718),m=i(43856),u=i(92475),x=i(71007),j=i(8323),v=i(70545),p=i(49338),b=i(50974),N=i(81490),g=i(22137),y=i(80899),A=i(52205),f=i(92601),w=i(12528),C=i(51399),I=i(64603),k=i(95178),S=i(70579);const F=e=>{let{id:s,isOpen:i,setIsOpen:l,editItem:t,onSuccess:d}=e;const[n]=(0,I._i)(),[c]=(0,I.eP)(),[o,h]=(0,a.useState)(!1),[j,p]=(0,a.useState)([]),[b,N]=(0,a.useState)([]),[g,F]=(0,a.useState)(""),[T,P]=(0,a.useState)(!1),[E,O]=(0,a.useState)(!1),L=(0,a.useRef)(null);(0,a.useEffect)((()=>{(async()=>{P(!0);try{const e=await(0,k.hU)();p(e),N(e)}catch(e){(0,f.A)((0,S.jsxs)("span",{className:"d-flex align-items-center",children:[(0,S.jsx)(u.A,{icon:"Error",size:"lg",className:"me-1"}),(0,S.jsx)("span",{children:"Failed to load users"})]}),"Please try again later.")}finally{P(!1)}})()}),[]),(0,a.useEffect)((()=>{N(g?j.filter((e=>{var s;return null===(s=e.fullName)||void 0===s?void 0:s.toLowerCase().includes(g.toLowerCase())})):j)}),[g,j]),(0,a.useEffect)((()=>{const e=e=>{L.current&&!L.current.contains(e.target)&&O(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}}),[]);const _=(0,r.Wx)({initialValues:{threadName:(null===t||void 0===t?void 0:t.threadName)||"",visibility:(null===t||void 0===t?void 0:t.visibility)||"Public",description:(null===t||void 0===t?void 0:t.description)||"",ownerId:(null===t||void 0===t?void 0:t.ownerId)||""},validationSchema:y.Ik({threadName:y.Yj().required("Thread name is required").min(3,"Thread name must be at least 3 characters"),visibility:y.Yj().required("Visibility is required").oneOf(["Public","Private"],"Invalid visibility option"),description:y.Yj().min(5,"Description must be at least 5 characters"),ownerId:y.Yj().required("Owner is required")}),enableReinitialize:!0,onSubmit:async e=>{h(!0);try{null!==t&&void 0!==t&&t._id?await c({id:t._id,body:e}).unwrap():await n(e).unwrap(),(0,f.A)((0,S.jsxs)("span",{className:"d-flex align-items-center",children:[(0,S.jsx)(u.A,{icon:"CheckCircle",size:"lg",className:"me-1"}),(0,S.jsx)("span",{children:t?"Thread Updated":"Thread Added"})]}),`${e.threadName} has been ${t?"updated":"added"} successfully.`),_.resetForm(),l(!1),null===d||void 0===d||d()}catch(s){console.error(s),(0,f.A)((0,S.jsxs)("span",{className:"d-flex align-items-center",children:[(0,S.jsx)(u.A,{icon:"Error",size:"lg",className:"me-1"}),(0,S.jsx)("span",{children:"Error"})]}),`Failed to ${t?"update":"add"} thread. Please try again.`)}finally{h(!1)}}});return i?(0,S.jsxs)(A.Ay,{isOpen:i,setIsOpen:l,size:"md",titleId:s,isStaticBackdrop:!0,isCentered:!0,children:[(0,S.jsx)(A.rQ,{setIsOpen:l,className:"p-4",children:(0,S.jsx)(A.wt,{id:s,children:t?"Edit Thread":"Add New Thread"})}),(0,S.jsxs)(A.cw,{className:"px-4",children:[(0,S.jsx)(v.A,{id:"threadName",label:"Thread Name",className:"mb-3",children:(0,S.jsx)(x.A,{id:"threadName",name:"threadName",placeholder:"Enter thread name",onChange:_.handleChange,onBlur:_.handleBlur,value:_.values.threadName,isTouched:!!_.touched.threadName,isValid:!_.errors.threadName,invalidFeedback:_.errors.threadName})}),(0,S.jsx)(v.A,{id:"description",label:"Description",className:"mb-3",children:(0,S.jsx)(x.A,{id:"description",name:"description",placeholder:"Enter description",onChange:_.handleChange,onBlur:_.handleBlur,value:_.values.description,isTouched:!!_.touched.description,isValid:!_.errors.description,invalidFeedback:_.errors.description})}),(0,S.jsx)(v.A,{id:"visibility",label:"Visibility",className:"mb-3",children:(0,S.jsxs)(w.A,{id:"visibility",name:"visibility",onChange:_.handleChange,onBlur:_.handleBlur,value:_.values.visibility,isTouched:!!_.touched.visibility,isValid:!_.errors.visibility,invalidFeedback:_.errors.visibility,ariaLabel:"",children:[(0,S.jsx)(C.A,{value:"Public",children:"Public"}),(0,S.jsx)(C.A,{value:"Private",children:"Private"})]})}),(0,S.jsx)(v.A,{id:"ownerId",label:"Owner (search by name)",className:"mb-3",children:(0,S.jsxs)("div",{ref:L,children:[(0,S.jsx)(x.A,{type:"text",placeholder:"Search user...",onFocus:()=>O(!0),onChange:e=>{F(e.target.value),O(!0),_.setFieldTouched("ownerId",!0)},value:g,className:"mb-2"}),E?(0,S.jsx)("div",{className:"border rounded p-2",style:{maxHeight:"200px",overflowY:"auto"},children:T?(0,S.jsx)("div",{children:"Loading users..."}):0===b.length?(0,S.jsx)("div",{className:"text-muted",children:"No user found"}):b.map((e=>(0,S.jsx)("div",{className:"p-2 rounded mb-1 "+(_.values.ownerId===e._id?"bg-primary text-white":"hover:bg-light"),style:{cursor:"pointer"},onClick:()=>{_.setFieldValue("ownerId",e._id),F(e.fullName),O(!1)},children:e.fullName},e._id)))}):null,_.touched.ownerId&&_.errors.ownerId&&(0,S.jsx)("div",{className:"text-danger mt-1",children:_.errors.ownerId})]})})]}),(0,S.jsxs)(A.jl,{className:"px-4 pb-4",children:[(0,S.jsx)(m.A,{color:"secondary",onClick:()=>l(!1),className:"me-2",isDisable:o,children:"Cancel"}),(0,S.jsxs)(m.A,{color:"primary",onClick:_.handleSubmit,isDisable:o,children:[t?"Update Thread":"Add Thread"," ",o&&"..."]})]})]}):null};var T=i(93981),P=i(82151),E=i(73980);const O=e=>{if(void 0===e||null===e)return"primary";try{const s="string"===typeof e?parseInt(e,10)||0:e;return(0,N.$)(Math.abs(s)%20)}catch{return"primary"}},L=()=>{var e,s;const{darkModeStatus:i}=(0,g.A)(),[N,y]=(0,a.useState)(1),[A,w]=(0,a.useState)(h.CQ[10]),[C]=(0,I.K4)(),[k,L]=(0,a.useState)(!1),[_,q]=(0,a.useState)(void 0),[z,D]=(0,a.useState)({isOpen:!1,src:"",name:""}),{data:V,isLoading:$,isError:B,refetch:M}=(0,I.Hk)({page_number:N,page_size:A}),Q=Array.isArray(null===V||void 0===V||null===(e=V.data)||void 0===e?void 0:e.data)?null===(s=V.data)||void 0===s?void 0:s.data:[],R=(0,r.Wx)({initialValues:{searchInput:"",threadIdFilter:""},onSubmit:()=>{}}),Y=null===Q||void 0===Q?void 0:Q.filter((e=>{var s;return!!e&&((null===(s=e.threadName)||void 0===s?void 0:s.toLowerCase().includes(R.values.searchInput.toLowerCase()))||"")}));console.log("filteredDatafilteredData",Y);const{items:U,requestSort:H,getClassNamesFor:J}=(0,p.A)(Y);console.log("itemsitems",U);const W=()=>{M()};return(0,S.jsxs)(l.A,{title:n.P9.crm.subMenu.customersList.text,className:"mt-3",children:[(0,S.jsxs)(t.Ay,{children:[(0,S.jsxs)(t.n5,{children:[(0,S.jsx)("label",{className:"border-0 bg-transparent cursor-pointer me-0",htmlFor:"searchInput",children:(0,S.jsx)(u.A,{icon:"Search",size:"2x",color:"primary"})}),(0,S.jsx)(x.A,{id:"searchInput",type:"search",className:"border-0 shadow-none bg-transparent",placeholder:"Search threads...",onChange:R.handleChange,value:R.values.searchInput})]}),(0,S.jsxs)(t.qb,{children:[(0,S.jsxs)(j.Ay,{children:[(0,S.jsx)(j.C,{hasIcon:!1,children:(0,S.jsx)(m.A,{icon:"FilterAlt",color:"dark",isLight:!0,className:"btn-only-icon position-relative","aria-label":"Filter",children:Q.length!==Y.length&&(0,S.jsx)(b.A,{desc:"Filtering applied",trigger:"hover",children:(0,S.jsx)("span",{className:"position-absolute top-0 start-100 translate-middle badge border border-light rounded-circle bg-danger p-2",children:(0,S.jsx)("span",{className:"visually-hidden",children:"there is filtering"})})})})}),(0,S.jsx)(j.rI,{isAlignmentEnd:!0,size:"lg",children:(0,S.jsx)("div",{className:"container py-2",children:(0,S.jsx)("div",{className:"row g-3",children:(0,S.jsx)(v.A,{label:"Thread ID",className:"col-12",children:(0,S.jsx)(x.A,{id:"threadIdFilter",ariaLabel:"Thread ID",placeholder:"Filter by Thread ID",onChange:R.handleChange,value:R.values.threadIdFilter})})})})})]}),(0,S.jsx)(t.ro,{}),(0,S.jsx)(m.A,{icon:"PersonAdd",color:"primary",isLight:!0,onClick:()=>{L(!0),q(void 0)},children:"New Thread"})]})]}),(0,S.jsx)(d.A,{children:(0,S.jsx)("div",{className:"row h-100",children:(0,S.jsx)("div",{className:"col-12",children:B?(0,S.jsx)(T.A,{}):$?(0,S.jsx)(P.A,{}):(0,S.jsxs)(c.Ay,{stretch:!0,children:[(0,S.jsx)(c.bw,{isScrollable:!0,className:"table-responsive",children:(0,S.jsxs)("table",{className:"table table-modern table-hover",children:[(0,S.jsx)("thead",{children:(0,S.jsxs)("tr",{children:[(0,S.jsxs)("th",{className:"text-center cursor-pointer",onClick:()=>H("_id"),children:["Thread"," ",(0,S.jsx)(u.A,{size:"lg",className:J("_id"),icon:"FilterList"})]}),(0,S.jsx)("th",{className:"text-center",children:"Thread Name"}),(0,S.jsx)("th",{className:"text-center",children:"Visibility"}),(0,S.jsx)("th",{className:"text-center",children:"Total Members"}),(0,S.jsx)("th",{className:"text-center",children:"QR Code"}),(0,S.jsx)("th",{className:"text-center",children:"Actions"})]})}),(0,S.jsx)("tbody",{children:(0,h.li)(U,N,A).map((e=>(0,S.jsxs)("tr",{children:[(0,S.jsx)("td",{className:"text-center",children:(0,S.jsx)("div",{className:"d-flex align-items-center justify-content-center",children:(0,S.jsx)("div",{className:"flex-shrink-0",children:(0,S.jsx)("div",{className:"ratio ratio-1x1 me-3",style:{width:48},children:(0,S.jsx)("div",{className:`bg-l${i?"o25":"25"}-${O(null===e||void 0===e?void 0:e._id)} text-${O(null===e||void 0===e?void 0:e._id)} rounded-2 d-flex align-items-center justify-content-center`,children:(0,S.jsx)("span",{className:"fw-bold",children:(0,o.Vz)((null===e||void 0===e?void 0:e.threadName)||"")})})})})})}),(0,S.jsx)("td",{className:"text-center",children:(0,S.jsx)("div",{className:"fs-6 fw-bold",children:(null===e||void 0===e?void 0:e.threadName)||"N/A"})}),(0,S.jsx)("td",{className:"text-center",children:(0,S.jsx)("div",{className:"fs-6 fw-bold",children:(null===e||void 0===e?void 0:e.visibility)||"N/A"})}),(0,S.jsx)("td",{className:"text-center",children:(0,S.jsx)("div",{className:"fs-6 fw-bold",children:null!==e&&void 0!==e&&e.members?e.members.length:"N/A"})}),(0,S.jsx)("td",{className:"text-center",children:null!==e&&void 0!==e&&e.qrCode?(0,S.jsx)("div",{className:"d-flex justify-content-center",onClick:()=>D({isOpen:!0,src:`https://backend.kandicompass.com/${e.qrCode}`,name:null===e||void 0===e?void 0:e.threadName}),children:(0,S.jsx)("div",{style:{width:"50px",height:"50px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer"},children:(0,S.jsx)("img",{src:`https://backend.kandicompass.com/${e.qrCode}`,alt:"QR Code",style:{width:"100%",height:"100%",objectFit:"contain"}})})}):(0,S.jsx)("div",{className:"fs-6 text-muted",children:"No QR"})}),(0,S.jsx)("td",{className:"text-center",children:(0,S.jsxs)(j.Ay,{children:[(0,S.jsx)(j.C,{hasIcon:!1,children:(0,S.jsx)(m.A,{icon:"MoreHoriz",color:"dark",isLight:!0,shadow:"sm","aria-label":"More actions"})}),(0,S.jsxs)(j.rI,{isAlignmentEnd:!0,children:[(0,S.jsx)(j.tJ,{children:(0,S.jsx)(m.A,{icon:"Print",onClick:()=>D({isOpen:!0,src:`https://backend.kandicompass.com/${e.qrCode}`,name:null===e||void 0===e?void 0:e.threadName}),children:"Print QR"})}),(0,S.jsx)(j.tJ,{children:(0,S.jsx)(m.A,{icon:"Edit",onClick:()=>{q(e),L(!0)},children:"Edit"})}),(0,S.jsx)(j.tJ,{children:(0,S.jsx)(m.A,{icon:"Delete",onClick:()=>(async e=>{if(e&&window.confirm("Are you sure you want to delete this thread?"))try{await C(e).unwrap(),W(),(0,f.A)((0,S.jsxs)("span",{className:"d-flex align-items-center",children:[(0,S.jsx)(u.A,{icon:"CheckCircle",size:"lg",className:"me-1"}),(0,S.jsx)("span",{children:"Thread Deleted"})]}),"Thread has been deleted successfully.")}catch(s){console.error("Failed to delete thread:",s),(0,f.A)((0,S.jsxs)("span",{className:"d-flex align-items-center",children:[(0,S.jsx)(u.A,{icon:"Error",size:"lg",className:"me-1"}),(0,S.jsx)("span",{children:"Error"})]}),"Failed to delete thread. Please try again.")}})(null===e||void 0===e?void 0:e._id),children:"Delete"})})]})]})})]},(null===e||void 0===e?void 0:e._id)||Math.random())))})]})}),(0,S.jsx)(h.Ay,{data:Y,label:"threads",setCurrentPage:y,currentPage:N,perPage:A,setPerPage:w})]})})})}),(0,S.jsx)(E.A,{isOpen:z.isOpen,setIsOpen:()=>D({...z,isOpen:!1,src:"",name:""}),beadName:z.name,qrUrl:z.src}),(0,S.jsx)(F,{id:"thread-modal",isOpen:k,setIsOpen:()=>{L(!1),q(void 0)},editItem:_,onSuccess:W})]})}}}]);
//# sourceMappingURL=451.e15aebcc.chunk.js.map